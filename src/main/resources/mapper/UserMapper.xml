<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="top.yanzx.cunzhao.dao.UserDao">

    <select id="countUser" resultType="Integer">
        SELECT count(0)
        FROM `sys_user` u
        WHERE u.delete_status = '1'
    </select>


    <select id="listUser">
        SELECT u.*,
               r.id        roleId,
               r.role_name roleName
        FROM (
                 SELECT id                                      userId,
                        username                                username,
                        nickname                                nickname,
                        delete_status                           deleteStatus,
                        DATE_FORMAT(create_time, '%Y.%m.%d %T') createTime,
                        DATE_FORMAT(update_time, '%Y.%m.%d %T') updateTime
                 FROM sys_user
                 WHERE delete_status = '1'
                 ORDER BY id
                     LIMIT #{offSet}, #{pageRow}
             ) u
                 LEFT JOIN sys_user_role ur on ur.user_id = u.userId
                 LEFT JOIN sys_role r ON r.id = ur.role_id
        ORDER BY u.userId, r.id
    </select>
</mapper>
